---
title: "Gene mapping procedure"
author: Kaixuan Luo
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Despite our fine mapping efforts, there remains considerable uncertainty of 
causal variants in most loci. 
Even if the causal variants are known, 
assigning target genes can be difficult due to complex, 
often long-range, regulatory relationships between enhancers and genes.

We developed a novel procedure to address these problems:

  1. For every putative causal SNP, we assign a weight to each nearby gene, 
  taking into account multiple ways a SNP may affect a gene. 
  The weight of a nearby gene can be viewed as the probability 
  that this SNP targets that gene. 
  
  2. The PIP of each SNP is then distributed among all potential target genes 
  according to the weights of these genes. The “fractional PIP” a gene receives 
  from a SNP can be viewed as the support the SNP provides to that gene. 
  
  3. For each gene, we then sum over the fractional PIPs it receives from 
  all candidate SNPs in the region. The resulting “gene PIP” approximates the 
  probability of a gene being causal (Methods). Similar to variant-level 
  fine mapping, we also define a “gene credible set”, the set of genes that 
  capture the causal signal at a locus with high probability (80% in our study)

```{r gene-mapping-diagram, echo=FALSE, fig.cap="**Schematic of gene-level PIP calculation.** s: SNP, g: gene", out.width = '75%'}
knitr::include_graphics("gene.mapping.diagram.png")
```



